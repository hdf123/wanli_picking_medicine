<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>申请退款</title>
		<link rel="stylesheet" href="../../css/base.css" />
		<link rel="stylesheet" href="../../css/iconfont.css" />
		<link rel="stylesheet" href="../../css/layout.css" />
		<link rel="stylesheet" href="css/refund.css" />
		<script src="../../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/ajaxs.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/children.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<header class="headersd">
			<div class="iconfont icon-houtui" onclick="javascript:history.back(-1);"></div>
			<div>申请退款</div>
			<div></div>
		</header>
		<section class="sets">
			<div>
				<div class="rea">
					<div class="sureb">
						<div>
							<img src="../../img/eq_03.png" alt="" />
						</div>
						<div>
							<div>
								三人输液椅打针点滴连长三人输液椅打针点滴连长
							</div>
							<div>
								<div class="iconfont icon-jinqian">2169</div>
								<div>X<span>1</span></div>
							</div>
						</div>
					</div>
				</div>
				<div class="refua">
					<div>
						<span class="ga">退款原因</span>
						<i class="iconfont icon-qianjin"></i>
					</div>
				</div>
				<div class="refub">
					<div>
						<span>退款金额:</span>
						<div class="jes iconfont icon-jinqian"><span>2169.00</span></div>
					</div>
					<div>
						<span class="gb">退款说明</span>
						<input type="text" class="instructions" placeholder="选填" />
					</div>
				</div>
			</div>
		</section>
		<footer class="footersd">提交</footer>
		<div class="wdowsd">
			<div>
				<div>退款原因</div>
				<div class="statesd">
					<div>
						<span>不喜欢/不想要</span>
						<i class="iconfont icon-danxuankuang"></i>
					</div>
					<div>
						<span>空包裹</span>
						<i class="iconfont icon-danxuankuang"></i>
					</div>
					<div>
						<span>未按约定时间发货</span>
						<i class="iconfont icon-danxuankuang"></i>
					</div>
					<div>
						<span>快递/物流一直未送到</span>
						<i class="iconfont icon-danxuankuang"></i>
					</div>
					<div>
						<span>货物破损已拒签</span>
						<i class="iconfont icon-danxuankuang"></i>
					</div>
				</div>
				<div>关闭</div>
			</div>
		</div>
<script type="text/javascript">
	$(function(){
		$(".wdows").hide();//货物状态
		$(".wdowsd").hide();//未签收，退款原因
		var ksk=getRequest().indexs;
		if(ksk==0){
			$(".headersd>div:eq(1)").html("申请退款");
			$(".ga").html("退款原因");
			$(".gb").html("退款说明");
		}else{
			$(".headersd>div:eq(1)").html("退货退款");
			$(".ga").html("退货原因");
			$(".gb").html("退货说明");
		}
		var logistics=JSON.parse(localStorage.getItem('logistics'));
		ajaxsd("order/findOrderById",'post',{equipmentOrderId:logistics.aa},function(data){
			var shangpin=data.equipmentOrderItem;
			var ks="",kk=0;
			for(i in shangpin){
				var image0=shangpin[i].equipmentGoodsId.picture.split(",");
				var mon=shangpin[i].equipmentGoodsId.presentPrice*shangpin[i].num;
				ks+=`<div class="sureb">
						<div>
							<img src=${image0[0]} alt="" />
						</div>
						<div>
							<div>${shangpin[i].equipmentGoodsId.name}</div>
							<div>
								<div class="iconfont icon-jinqian">${mon}</div>
								<div>X<span>${shangpin[i].num}</span></div>
							</div>
						</div>
					</div>`;
					kk+=mon;
			}
			$(".rea").html(ks);
			$(".jes").html(kk);//总价
		},function(err){
			console.log(err);
		})
	//未签收，退款原因
		$(".refua>div").click(function(){
			$(".wdowsd").show();
		})
		$(".wdowsd>div>div:eq(2)").click(function(){
			$(".wdowsd").hide();
		})
		var why="";
		$(".statesd>div").click(function(event){
			var ks=$(this);
			why=$(this).children("span").html();
			var ka=$(".wdowsd>div>div:eq(2)");//显示关闭字体显示
			funk(ks,ka);
			event.stopPropagation();//阻止冒泡
		})
	    $(".wdowsd").click(function(){//点击其他区域，隐藏
	    	$(".wdowsd").hide();
	    })
		function funk(ks,ka){
			var as=ks.children("i").is(".icon-danxuankuang");
			if(as){
				ka.html("确认");
				ks.children("i").removeClass("icon-danxuankuang");
				ks.children("i").addClass("icon-xuanze");
				ks.siblings("div").children("i").removeClass("icon-xuanze");
				ks.siblings("div").children("i").addClass("icon-danxuankuang");
			}
		}
		//提交退款申请
		$(".footersd").click(function(){
			var parameter={
				orderRefundid:logistics.aa,
				reason:why,//退款原因或退货原因
				body:$(".instructions").val(),
				type:ksk//退款类型0仅退款1退货退款 
			}
			console.log(parameter);
			ajaxsd("order/addRefundOrder",'post',parameter,function(data){
				console.log(data);
				window.location.href="order.html";
			},function(err){
				console.log(err);
			})
		})
	})
</script>
	</body>
</html>
