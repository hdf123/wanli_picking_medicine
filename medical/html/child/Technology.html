<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>医疗技术商</title>
		<link rel="stylesheet" href="../../css/base.css" />
		<link rel="stylesheet" href="../../css/iconfont.css" />
		<link rel="stylesheet" href="../../css/swiper-4.3.3.min.css" />
		<link rel="stylesheet" href="../../css/layout.css" />
		<link rel="stylesheet" href="css/Technology.css" />
		<script src="../../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/ajaxs.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/swiper-4.3.3.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/children.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.9&key=311194415586a84a3dab215eec8b10bb"></script>
	</head>
	<body>
		<header>
			<div class="iconfont icon-houtui"></div>
			<div id="locations">
				<div class="iconfont icon-weizhi-tianchong"></div>
				<div><span id="asd">上海</span></div>
			</div>
			<div id="symptoms">
				<input type="text" placeholder="搜索医疗技术商"/>
				<i class="iconfont icon-sousuo5"></i>
			</div>
			<div class="iconfont icon-huihua"></div>
		</header>
		<section class="sets">
			<div>
				<div>
					<div class="swiper-container" id="swiper1">
					    <div class="swiper-wrapper">
					        <!--<div class="swiper-slide">
					        	<img src="../../img/eq_03.png"/>
					        </div>-->
					    </div>
					    <div class="swiper-pagination"></div>
					</div>
				</div>
				<div class="techs">
					<div>获取附近技术商</div>
				</div>
				<div class="techa">
					<!--<div class="techb">
						<div>
							<img src="../../img/eq_02.png" alt="" />
						</div>
						<div>
							<div>
								<div>医疗维修店金水区</div>
								<div>1.1Km</div>
							</div>
							<div>
								<div>
									<i class="iconfont icon-pingji"></i
									><i class="iconfont icon-pingji"></i
									><i class="iconfont icon-pingji"></i
									><i class="iconfont icon-pingji"></i
									><i class="iconfont icon-pingji"></i>
								</div>
							</div>
							<div class="iconfont icon-dingwei">
								金水区商都路与通泰路交叉口
							</div>
						</div>
					</div>
					<div class="techb">
						<div>
							<img src="../../img/eq_02.png" alt="" />
						</div>
						<div>
							<div>
								<div>华大基因</div>
								<div>1.1Km</div>
							</div>
							<div>
								<div>
									<i class="iconfont icon-pingji"></i
									><i class="iconfont icon-pingji"></i
									><i class="iconfont icon-pingji"></i
									><i class="iconfont icon-pingji"></i
									><i class="iconfont icon-pingji"></i>
								</div>
							</div>
							<div class="iconfont icon-dingwei">
								金水区商都路与通泰路交叉口
							</div>
						</div>
					</div>-->
				</div>
			</div>
		</section>
<script type="text/javascript">
	$(function(){
		backs("javascript:history.back(-1)");//返回上一页加动画
		var locationk = JSON.parse(localStorage.getItem('location'));//定位城市
		$("#asd").html(locationk.aa);
		var mySwiper1 = new Swiper ('#swiper1',{//推荐
			loop:true,
			autoplay: true,//可选选项，自动滑动
			observer:true,//修改swiper自己或子元素时，自动初始化swiper
		    direction: 'horizontal',//水平滑动
		    pagination: {//分页
			    el: '.swiper-pagination',
			},
		})
		//定位
	    var jwd=JSON.parse(localStorage.getItem('jwd'));//经纬度
	    if(jwd==null){
		   	var map, geolocation;
			var longitude="";//经度
			var latitude="";//纬度
		    map = new AMap.Map('container',{//加载地图，调用浏览器定位服务
		        resizeEnable:true
		    });
		    map.plugin('AMap.Geolocation',function(){
		        geolocation = new AMap.Geolocation({
		            enableHighAccuracy: true,//是否使用高精度定位，默认:true
		            timeout:5000,          //超过5秒后停止定位，默认：无穷大
		            buttonOffset: new AMap.Pixel(10, 20),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
		            zoomToAccuracy: true,      //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
		            buttonPosition:'RB'
		        });
		        map.addControl(geolocation);
		        geolocation.getCurrentPosition();
		        
		        AMap.event.addListener(geolocation, 'complete', onComplete);//返回定位信息
		        AMap.event.addListener(geolocation, 'error', onError);      //返回定位出错信息
		    });
		    function onComplete(data) {//解析定位结果
		    	longitude=data.position.getLng();//经度
		    	latitude=data.position.getLat();//纬度
		    	jwd=longitude+","+latitude;//经纬度
		    	localStorage.setItem('jwd', JSON.stringify(jwd));
		    }
		    function onError(data){//解析定位错误信息
		    	console.log("定位失败！");
		    	jwd="113.734202,34.749687";//固定经纬度
		    }
	    }
//banner
	    ajaxsd("content/findContent",'post',{typeId:3},function(data){
	    	console.log(data);
	    	var ks="";
	    	for(i in data){
	    		$("#swiper1>.swiper-wrapper").append(`<div class="swiper-slide" data-techn=${data[i].url}>
											        	<img src=${data[i].pic} />
											        </div>`)
	    	}
			$("#swiper1").on("click",".swiper-slide",function(){
				var techn=$(this).data("techn");
				window.location.href="Shop_introduced.html?techn="+techn;
			})
	    },function(err){
			console.log(err);
		})
		var parameter={
			page:1,
			rows:10
		}
		ajaxsd("technology/searchTechnologyUser",'post',parameter,function(data){
			var data=data.rows,ks="";
			console.log(data);
			for(i in data){
				ks+=`<div class="techb" data-techn=${data[i].technologyUserId}>
						<div>
							<img src=${data[i].portrait} alt="" />
						</div>
						<div>
							<div>
								<div>${data[i].storeName}</div>
								<div></div>
							</div>
							<div>
								<div>
									<i class="iconfont icon-pingji"></i
									><i class="iconfont icon-pingji"></i
									><i class="iconfont icon-pingji"></i
									><i class="iconfont icon-pingji"></i
									><i class="iconfont icon-pingji"></i>
								</div>
							</div>
							<div class="iconfont icon-dingwei">${data[i].address}</div>
						</div>
					</div>`;
			}
			$(".techa").html(ks);
		},function(err){
			console.log(err);
		})
		//附近
		$(".techs>div").click(function(){
	    	ajaxsd("technology/findPeripheryTechnologyUser",'post',{coordinate:jwd},function(data){
	    		var data=data.datas;
	    		console.log(data);
	    		var ks="";
				for(i in data){
					var kms=data[i]._distance/1000;
					var kms=kms.toFixed(2);
					ks+=`<div class="techb" data-techn=${data[i].dataId}>
							<div>
								<img src=${data[i].portrait} alt="" />
							</div>
							<div>
								<div>
									<div>${data[i]._name}</div>
									<div>${kms}km</div>
								</div>
								<div>
									<div>
										<i class="iconfont icon-pingji"></i
										><i class="iconfont icon-pingji"></i
										><i class="iconfont icon-pingji"></i
										><i class="iconfont icon-pingji"></i
										><i class="iconfont icon-pingji"></i>
									</div>
								</div>
								<div class="iconfont icon-dingwei">${data[i]._address}</div>
							</div>
						</div>`;
				}
				$(".techa").html(ks);
	    	},function(err){
	    		console.log(err);
	    	})
		})
		//咨询
		ajaxsd("im/friendsList",'post',{},function(data){
			var data=data.message.uinfos;
			console.log(data);
			$(".icon-huihua").click(function(){//会话
				
				var imagek=data[0].icon;//头像
				var names=data[0].name;//名字
				var accid=data[0].accid;//id
				var arr=[0,accid,imagek,names];//类型、id、头像、名字
				console.log(arr);
				window.location.href="sessionb.html?index="+arr;
			})
		},function(err){
			console.log(err);
		})
		$(document).on("click",".techb",function(){
			var techn=$(this).data("techn");
			console.log(111);
			window.location.href="Shop_introduced.html?techn="+techn;
		})
		$("#locations").click(function(){//位置
			window.location.href="locations.html";
		})
		$("#symptoms").click(function(){//搜索技术商
			window.location.href="The_store.html";
		})
	})
</script>	
		
	</body>
</html>
