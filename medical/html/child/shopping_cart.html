<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>购物车</title>
		<link rel="stylesheet" href="../../css/base.css" />
		<link rel="stylesheet" href="../../css/iconfont.css" />
		<link rel="stylesheet" href="../../css/layout.css" />
		<link rel="stylesheet" href="css/shopping_cart.css" />
		<script src="../../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/ajaxs.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/children.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<header class="headersd">
			<div class="iconfont icon-houtui" onclick="javascript:history.back(-1);"></div>
			<div>购物车</div>
			<div>管理</div>
		</header>
		<section class="sets">
			<div>
				<div class="shopa">
					<div>
						<div class="iconfont icon-danxuankuang xuanz"></div>
						<div>
							<img src="../../img/eq_03.png" alt="" />
						</div>
						<div>
							<div>三人输液椅打针点滴连长三人输液椅打针点滴连长</div>
							<div>
								<div class="iconfont icon-jinqian">2169</div>
								<div class="nums">
									<div class="iconfont icon-jian"></div>
									<input type="text" placeholder="1" class="monsy" value="1" />
									<div class="iconfont icon-jia"></div>
								</div>
							</div>
						</div>
					</div>
					<div>淘宝</div>
				</div>
				<div class="shopa">
					<div>
						<div class="iconfont icon-danxuankuang xuanz"></div>
						<div>
							<img src="../../img/eq_03.png" alt="" />
						</div>
						<div>
							<div>三人输液椅打针点滴连长三人输液椅打针点滴连长</div>
							<div>
								<div class="iconfont icon-jinqian">2169</div>
								<div class="nums">
									<div class="iconfont icon-jian"></div>
									<input type="text" placeholder="1" class="monsy" value="1" />
									<div class="iconfont icon-jia"></div>
								</div>
							</div>
						</div>
					</div>
					<div>京东</div>
				</div>
				<div class="shopa">
					<div>
						<div class="iconfont icon-danxuankuang xuanz"></div>
						<div>
							<img src="../../img/eq_03.png" alt="" />
						</div>
						<div>
							<div>三人输液椅打针点滴连长三人输液椅打针点滴连长</div>
							<div>
								<div class="iconfont icon-jinqian">2169</div>
								<div class="nums">
									<div class="iconfont icon-jian"></div>
									<input type="text" placeholder="1" class="monsy" value="1" />
									<div class="iconfont icon-jia"></div>
								</div>
							</div>
						</div>
					</div>
					<div>天猫</div>
				</div>
			</div>
		</section>
		<footer class="totals">
			<div class="zongj">
				<div>全选</div>
			</div>
			<div class="jiesuan">
				<div>
					<div>合计：</div>
					<div class="iconfont icon-jinqian">0</div>
				</div>
				<div>结算(<span>2</span>)</div>
			</div>
		</footer>
<script type="text/javascript">
	$(function(){
		ajaxsd("cart/myShoppingCart",'post',{},function(data){
			console.log(data);
			var ks="";
			for(i in data){
				for(j in data[i].msg){
					var sd=data[i].msg[j].equipmentGoods.picture.split(",");
					var nums=data[i].msg[j].equipmentGoods.presentPrice*data[i].msg[j].num
					ks+=`<div class="shopa" data-sta=${data[i].msg[j].shoppingCartId} data-family=${data[i].msg[j].equipmentName}>
							<div>
								<div class="iconfont icon-danxuankuang xuanz"></div>
								<div>
									<img src=${sd[0]} alt="" />
								</div>
								<div>
									<div>${data[i].msg[j].equipmentGoods.name}</div>
									<div>
										<div class="iconfont icon-jinqian" data-jiag=${data[i].msg[j].equipmentGoods.presentPrice}>${nums}</div>
										<div class="nums">
											<div class="iconfont icon-jian"></div>
											<input type="text" placeholder="1" class="monsy" data-num=${data[i].msg[j].num} value=${data[i].msg[j].num} />
											<div class="iconfont icon-jia"></div>
										</div>
									</div>
								</div>
							</div>
							<div>${data[i].msg[j].equipmentName}</div>
						</div>`;
				}
			}
			$(".sets>div").html(ks);
			//增加商品
			$(".sets").on("click",".icon-jia",function(){
				var ints=$(this);
				var a1="cart/plusCartNum";
				var a2="+"
				funh(ints,a1,a2);
			})
			//减少商品
			$(".sets").on("click",".icon-jian",function(){
				var ints=$(this);
				var a1="cart/reduceCartNum";
				var a2="-"
				if($(this).siblings(".monsy").val()<=1){
					alert("至少选择一件商品");
				}else{
					funh(ints,a1,a2);
				}
			})
			$(".monsy").blur(function(){
				var ff=$(this);
				var num=$(this).val()=="";
				if($(this).val()==""||$(this).val()==0){
					alert("至少要选择一件商品");
					$(this).val($(this).data("num"));
				}else{
					var aa=$(this).closest(".shopa").data("sta");
					ajaxsd("cart/customCartNum",'post',{shoppingCartId:aa,num:num},function(data){
						console.log(data);
					},function(err){
						console.log(err);
					})	
				}
			})
			function funh(ints,a1,a2){
				var aa=ints.closest(".shopa").data("sta");
				ajaxsd(a1,'post',{shoppingCartId:aa},function(data){
					console.log(data);
					var ak=parseInt(ints.siblings(".monsy").val());
					if(a2=="+"){
						ints.siblings(".monsy").val(ak+1);
					}else{
						ints.siblings(".monsy").val(ak-1);
					}
				},function(err){
					console.log(err);
				})	
			}
			//选择
			var arr=[];
			$(".sets").on("click",".xuanz",function(){
				var aa=$(this);
				var xuanz=aa.closest(".shopa").data("family");
				if(arr.length==0){
					arr.push(xuanz);
					console.log(arr);
				}else{
					console.log(1);
					if(xuanz!=arr[0]){
						alert("同时只能结算单家商品!");
					}else{
						alert(2);
						
						if($(this).is(".icon-danxuankuang")){
							$(this).addClass("icon-xuanze");
							$(this).addClass("sha");
							$(this).removeClass("icon-danxuankuang");
						}else{
							$(this).addClass("icon-danxuankuang");
							$(this).removeClass("icon-xuanze");
							$(this).removeClass("sha");
						}
					}
				}
				console.log(xuanz);
			})
		},function(err){
			console.log(err);
		})
		


//选择
		/*$(".xuanz").click(function(){
			var aa=$(this);
			if($(this).is(".icon-danxuankuang")){
				$(this).addClass("icon-xuanze");
				$(this).addClass("sha");
				$(this).removeClass("icon-danxuankuang");
				fund(aa);//单间商品的总价
				funb(aa,dzj);//当前商品、当前商品总价
			}else{
				$(this).addClass("icon-danxuankuang");
				$(this).removeClass("icon-xuanze");
				$(this).removeClass("sha");
				fund(aa);//单间商品的总价
				func(aa,dzj);
			}
		})*/
	//获取单间商品的总价
		function fund(aa){
			var as=aa.closest(".shopa").find(".icon-jinqian").html();//商品价格
			var ak=aa.closest(".shopa").find(".monsy").val();//商品数量
			dzj=as*ak;//单价商品总价
			aa.closest(".shopa").data("zgs",dzj);
		}
	//总价计算
		var arr=[];
		function funb(aa,dzj){//选中
			var ad=aa.closest(".shopa").data("zgs");
			console.log(ad);
			arr.push(ad);
			console.log(arr);
			var ss=arr.join("+");
			$(".jiesuan .icon-jinqian").html(eval(ss));
			
			/*arr.push(dzj);
			var ss=arr.join("+");
			console.log(arr);
			$(".jiesuan .icon-jinqian").html(eval(ss))*/
		}
		function func(aa,dzj){//取消
			var jsd=$(".jiesuan .icon-jinqian").html();
			arr.splice($.inArray(dzj,arr),1);
			var ss=arr.join("+");
			$(".jiesuan .icon-jinqian").html(jsd-dzj)
		}
//全选、取消
		var fals=true,fala=true;
		$(".zongj").click(function(){
			if(fals){
				fals=false;
				$(".zongj>div").html("取消");
				$(".xuanz").addClass("icon-xuanze");
				$(".xuanz").addClass("sha");
				$(".xuanz").removeClass("icon-danxuankuang");
			}else{
				fals=true;
				$(".zongj>div").html("全选");
				$(".xuanz").addClass("icon-danxuankuang");
				$(".xuanz").removeClass("icon-xuanze");
				$(".xuanz").removeClass("sha");
			}
		})
//管理
		$(".headersd>div:eq(2)").click(function(){
			if(fala){
				fala=false;
				$(this).html("完成");
				$(".jiesuan").replaceWith(`<div class="shan">删除</div>`);
			}else{
				fala=true;
				funa();
			}
		})
//删除
		$(".totals").on("click",".shan",function(){
			console.log(1);
			if($(".xuanz").is(".icon-xuanze")){
				$(".icon-xuanze").parent().remove();
				funa();
			}
		})
		function funa(){
			$(".headersd>div:eq(2)").html("管理");
			$(".shan").replaceWith(`<div class="jiesuan">
										<div>
											<div>合计：</div>
											<div class="iconfont icon-jinqian">46546</div>
										</div>
										<div>结算(<span>2</span>)</div>
									</div>`);
			
		}
//结算
		$(".jiesuan>div:nth-child(2)").click(function(){
			console.log(1);
			
		})
	})
</script>
	</body>
</html>
