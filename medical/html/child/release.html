<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>我发布的</title>
		<link rel="stylesheet" href="../../css/base.css" />
		<link rel="stylesheet" href="../../css/iconfont.css" />
		<link rel="stylesheet" href="../../css/layout.css" />
		<link rel="stylesheet" href="css/release.css" />
		<script src="../../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/ajaxs.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/children.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<header class="headersd">
			<div class="iconfont icon-houtui" onclick="javascript:history.back(-1);"></div>
			<div>我发布的</div>
			<div>管理</div>
		</header>
		<section class="sets">
			<div></div>
		</section>
		<footer>
			<div>删除</div>
		</footer>
<script type="text/javascript">
	$(function(){
		$("footer").hide();
		var falseg=true;//管理
		var parameter={
			page:1,
			rows:4
		}
		var arr=[];
		ajaxsd("dynamic/findMyDynamic",'post',parameter,function(data){
			console.log(data);
			funz(data);
		},function(err){
			console.log(err);
		})
		loadmore('.sets','dynamic/findMyDynamic','post',parameter,function (data) {
			console.log(data);
		    funz(data);
		},function (err){
			console.log(err);
		});
		function funz(data){
			var ks="";
			for(i in data){
				//计算时间
				var kjh=times(data[i].time);
				var imga=data[i].dynamic.image;
				var imgs= imga.substr(0,imga.length - 1).split(",");
				ks+=`<div class="relea" data-dynamicid=${data[i].dynamic.dynamicId}>
						<div class="xzs iconfont icon-danxuankuang"></div>
						<div>
							<div>
								<div>
									<img src=${data[i].dynamic.user.avatar} alt="" />
								</div>
								<div>
									<div>${data[i].dynamic.user.nickName}</div>
									<div>${kjh}</div>
								</div>
							</div>
							<div>
								<div>
									<img src=${imgs[0]} alt="" />
								</div>
								<div>${data[i].dynamic.dynamicBody}</div>
							</div>
						</div>
					</div>`;
			}
			$(".sets>div").append(ks);
			if(!falseg){
				$(".headersd>div:eq(2)").html("完成");
				$("footer").show(10,function(){
					$(".sets").css({"bottom":"5rem"});
				});
				$(".xzs").show(10,function(){
					$(".relea>div:eq(1)").css({"width":"90%"});
				});
			}else{
				$(".headersd>div:eq(2)").html("管理");
				$("footer").hide(10,function(){
					$(".sets").css({"bottom":"0"});
				});
				$(".xzs").hide(10,function(){
					$(".relea>div:eq(1)").css({"width":"100%"});
				});
			}
			//选中、取消
			$(".sets").on("click",".xzs",function(event){
				var aa=$(this);
				var dynamicid=$(this).closest(".relea").data("dynamicid");
				console.log(dynamicid);
				if(aa.is(".icon-danxuankuang")){
					aa.removeClass("icon-danxuankuang");
					aa.addClass("icon-xuanze");
					arr.push(dynamicid);
				}else{
					aa.removeClass("icon-xuanze");
					aa.addClass("icon-danxuankuang");
					arr = $.grep(arr,function(value){//取消的时候删除添加的id
					 	return value != dynamicid;
					});
				}
				event.stopPropagation();
			})
			//查看动态
			$(".sets").on("click",".relea",function(){
				var dynamicid=$(this).data("dynamicid");
				window.location.href="communication_child.html?dynamicid="+dynamicid;
			})
		}
//管理、完成
		$(".headersd>div:eq(2)").click(function(){
			if(falseg){
				falseg=false;
				$(".headersd>div:eq(2)").html("完成");
				$("footer").show(10,function(){
					$(".sets").css({"bottom":"5rem"});
				});
				$(".xzs").show(10,function(){
					$(".relea>div:eq(1)").css({"width":"90%"});
				});
			}else{
				falseg=true;
				$(".headersd>div:eq(2)").html("管理");
				$("footer").hide(10,function(){
					$(".sets").css({"bottom":"0"});
				});
				$(".xzs").hide(10,function(){
					$(".relea>div:eq(1)").css({"width":"100%"});
				});
			}
		})
//删除动态
		$("footer>div").click(function(){
			console.log(arr);
			var joins=arr.join(",");
			console.log(joins);
			ajaxsd("dynamic/deleDynamic",'post',{dynamicId:joins},function(data){
				console.log(data);
				window.location.reload();
			},function(err){
				console.log(err);
			})
		})
	})
</script>
	</body>
</html>
